<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat com Verificação</title>
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-database.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
</head>
<body class="bg-gray-100 p-4">
  <div class="max-w-lg mx-auto bg-white rounded-lg shadow-lg p-6">
    <h1 class="text-2xl font-bold mb-4">Chat</h1>
    <div id="messages" class="bg-gray-200 rounded-lg h-64 overflow-y-scroll p-4 mb-4"></div>
    <input
      type="text"
      id="messageInput"
      placeholder="Digite sua mensagem..."
      class="w-full border rounded-lg px-4 py-2 mb-2"
    />
    <button
      id="sendButton"
      class="bg-blue-500 text-white rounded-lg px-4 py-2"
    >
      Enviar
    </button>
  </div>

  <script>
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyAka2HFWwP9OHc_OC2IDFio0wPPtqADhmA",
      authDomain: "kelvinchat-f9499.firebaseapp.com",
      databaseURL: "https://kelvinchat-f9499-default-rtdb.firebaseio.com",
      projectId: "kelvinchat-f9499",
      storageBucket: "kelvinchat-f9499.firebasestorage.app",
      messagingSenderId: "972962322611",
      appId: "1:972962322611:web:ff5416bb049abea350f8c6",
      measurementId: "G-K99GCK98ZR"
    };

    // Inicializar Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Referência ao nó do chat no banco de dados
    const chatRef = database.ref("Chat");

    // Seletores
    const messagesDiv = document.getElementById("messages");
    const messageInput = document.getElementById("messageInput");
    const sendButton = document.getElementById("sendButton");

    // ID de usuário e nome de exemplo
    const userId = Math.random().toString(36).substring(2, 15);
    const username = "Usuário_" + userId.substring(0, 5);

    // Enviar mensagem
    sendButton.addEventListener("click", () => {
      const message = messageInput.value.trim();
      if (message) {
        const newMessageRef = chatRef.push();
        newMessageRef.set({
          text: message,
          sender: username,
          userId,
          verificado: false, // Adiciona "verificado" como padrão "false"
          ceo: false, // Adiciona "ceo" como padrão "false"
        });
        messageInput.value = "";
      }
    });

    // Ouvir mensagens do banco de dados e renderizar na tela
    chatRef.on("value", (snapshot) => {
      messagesDiv.innerHTML = "";
      snapshot.forEach((childSnapshot) => {
        const message = childSnapshot.val();

        const messageDiv = document.createElement("div");
        messageDiv.classList.add("mb-2");

        const sender = document.createElement("span");
        sender.textContent = `${message.sender}: `;

        // Verificar o campo "verificado" ou "ceo" e exibir o ícone correspondente
        if (message.verificado) {
          const verifiedBadge = document.createElement("img");
          verifiedBadge.src =
            "https://res.cloudinary.com/dfjdlqyjl/image/upload/v1736626740/verificar_1_qtfrdt.png"; // Ícone "Verificado"
          verifiedBadge.alt = "Verificado";
          verifiedBadge.classList.add("inline-block", "ml-2", "w-4", "h-4");
          sender.appendChild(verifiedBadge);
        } else if (message.ceo) {
          const ceoBadge = document.createElement("img");
          ceoBadge.src =
            "https://res.cloudinary.com/dfjdlqyjl/image/upload/v1736626740/verificar_i35hrp.png"; // Ícone "CEO"
          ceoBadge.alt = "CEO";
          ceoBadge.classList.add("inline-block", "ml-2", "w-4", "h-4");
          sender.appendChild(ceoBadge);
        }

        const messageText = document.createElement("span");
        messageText.textContent = message.text;

        messageDiv.appendChild(sender);
        messageDiv.appendChild(messageText);
        messagesDiv.appendChild(messageDiv);
      });
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });
  </script>
</body>
</html>
